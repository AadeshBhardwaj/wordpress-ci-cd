version: 0.2

env:
  parameter-store:
    DB_NAME: "/aadesh/DB_Name"
    DB_USER: "/aadesh/DB_User"
    DB_PASSWORD: "/aadesh/DB_Password"
    DB_HOST: "/aadesh/DB_Host"

phases:
  install:
    runtime-versions:
      php: 8.1.6
    commands:
      - apt update -y
      - apt install nginx php-fpm -y  
      - php -v
  pre_build:
    commands:
      - sed -i 's/database_name_here/'$DB_NAME'/' wp-config.php
      - sed -i 's/username_here/'$DB_USER'/' wp-config.php
      - sed -i 's/password_here/'$DB_PASSWORD'/' wp-config.php
      - sed -i 's/localhost/'$DB_HOST'/' wp-config.php
      - curl localhost:80 2>&1 --head -o request.txt
  build:
    commands:
      - grep -Fq "Server: nginx" request.txt
      - grep -Fq "200 OK" request.txt
      - grep -Fq "Aadesh" index.html
artifacts:
  files:
    - '**/*'
